##
## Compilation
##

C++ = clang++ ;
LINK = clang++ ;

# If I was building a library, these would be useful
# LINKFLAGS = -shared ;
# if $(UNIX)      { SUFSHR = .so ; }
# else if $(NT)   { SUFSHR = .dll ; }
		
## Compiler arguments

# Arguments used on all projects, regardless of any variables
# BT_USE_DOUBLE_PRECISION solves the Dantzig LCP missing definition
C++FLAGS = -std=c++11 -Wall -Wextra -Wno-unused-parameter -DBT_USE_DOUBLE_PRECISION -g ;

HDRS = src bullet3/src ;

SFML_HDRS = base2.0 ;
OGRE_HDRS = ../ogre2-template/include ;

if $(DEBUG_BUILD)
{ BULLET3_BUILD_DIR = bullet3/build_cmake_debug ; }
else
{ BULLET3_BUILD_DIR = bullet3/build_cmake ; }

OPTIM = -O0 ;

##
## Linking
##

COMMON_LIBS =
# Standard
-lpthread -ldl

# Bullet libraries
-L$(BULLET3_BUILD_DIR)/src/BulletDynamics
-L$(BULLET3_BUILD_DIR)/src/BulletCollision
-L$(BULLET3_BUILD_DIR)/src/Bullet3Common
-L$(BULLET3_BUILD_DIR)/src/LinearMath

-lBullet3Common
-lBulletDynamics
-lBulletCollision
-lLinearMath

# Stuff I'm not using, but could use
# -L$(BULLET3_BUILD_DIR)/src/BulletSoftBody
# -L$(BULLET3_BUILD_DIR)/src/BulletInverseDynamics
# -L$(BULLET3_BUILD_DIR)/src/Bullet3InverseDynamicsUtils
# -lBulletSoftBody
# -lBulletInverseDynamics
# -lBulletInverseDynamicsUtils
;

SFML_LIBS = 
# SFML
-lsfml-audio -lsfml-graphics -lsfml-window -lsfml-system

# OpenGL
-lGL
-lGLU

# Base
-Lbase2.0 -lBase20
;

OGRE_LIBS =
# Mogre
-L../ogre2-template
-lMogre
# Ogre
-L../ogre2-template/Ogre/ogre/build/Release/lib
-L../ogre2-template/build_ogre_gltf
-lOgreHlmsPbs
-lOgreHlmsUnlit
-lOgreMain

# Ogre 2D overlays
-lOgreOverlay

# TODO This should eventually be stripped out
-lOgreSamplesCommon

-lSDL2

# Gltf support
-Lbuild_ogre_gltf
-lOgre_glTF
;

# Note that this is overridden by most Mains
LINKLIBS =
$(COMMONLIBS)
;

# LINKFLAGS = -Wl,-rpath,. ;

# TODO: Copy libs to better directory, or static link?
LINKFLAGS =
-g
-Wl,-rpath,.:$(BULLET3_BUILD_DIR)/src/BulletSoftBody:$(BULLET3_BUILD_DIR)/Extras/InverseDynamics:$(BULLET3_BUILD_DIR)/src/BulletInverseDynamics:$(BULLET3_BUILD_DIR)/examples/ThirdPartyLibs/BussIK:$(BULLET3_BUILD_DIR)/src/BulletDynamics:$(BULLET3_BUILD_DIR)/src/BulletCollision:$(BULLET3_BUILD_DIR)/src/LinearMath:$(BULLET3_BUILD_DIR)/src/Bullet3Common:$(BULLET3_BUILD_DIR)/src/Bullet3Collision ;

# This is a bit unfortunate: Jam does something weird when I try to append linkflags. I'll just copy paste for now
OGRE_LINKFLAGS = -g
-Wl,-rpath,.:$(BULLET3_BUILD_DIR)/src/BulletSoftBody:$(BULLET3_BUILD_DIR)/Extras/InverseDynamics:$(BULLET3_BUILD_DIR)/src/BulletInverseDynamics:$(BULLET3_BUILD_DIR)/examples/ThirdPartyLibs/BussIK:$(BULLET3_BUILD_DIR)/src/BulletDynamics:$(BULLET3_BUILD_DIR)/src/BulletCollision:$(BULLET3_BUILD_DIR)/src/LinearMath:$(BULLET3_BUILD_DIR)/src/Bullet3Common:$(BULLET3_BUILD_DIR)/src/Bullet3Collision:../ogre2-template:../ogre2-template/build_ogre_gltf:../ogre2-template/Ogre/ogre/build/Release/lib ;

##
## Jam stuff
##

# Fix for unnecessary rebuilding any Jam project
KEEPOBJS = true ; # This doesn't actually fix anything, though it seems like it should
NOARSCAN = true ; # This actually fixes the problem
#AR = ar rUu ; # I was thinking maybe the AR command was wrong (always outputting deterministically)
               # It doesn't seem like this is the problem though
AR = ar cr ;

# Cross compilation
# E.g.
# jam -j4 -q -sCROSS_COMPILE_WINDOWS=true
# if $(CROSS_COMPILE_WINDOWS)
# {
# 	CC = x86_64-w64-mingw32-gcc ;
# 	LINK = x86_64-w64-mingw32-gcc ;
# 	AR = x86_64-w64-mingw32-ar ;
# 	SUFSHR = .dll ;
# }

# Some helpful Jam commands
# -q        : stop on failed target
# -jN       : use N cores
# -sVAR=VAL : Set VAR to VAL. Note that setting WINDOWS=false is the same as setting UNREAL=true,
#              frustratingly
# -dx       : print commands being used
# -n        : don't actually run commands
